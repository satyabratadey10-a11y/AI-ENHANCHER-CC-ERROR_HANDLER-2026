<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-powered photo upscaler with premium Glass UI">
    <meta name="theme-color" content="#667eea">
    <title>AI Photo Upscaler - Ultra Glass Pro</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --dark-bg: #0a0e27;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.15);
            --border-radius: 24px;
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--dark-bg);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Ambient Background */
        body::before {
            content: '';
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(102, 126, 234, 0.2), transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(240, 147, 251, 0.15), transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(79, 172, 254, 0.1), transparent 50%);
            z-index: -1;
            animation: bgMove 10s ease infinite alternate;
        }

        @keyframes bgMove {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        .container { max-width: 1200px; margin: 0 auto; position: relative; z-index: 1; }

        .header { text-align: center; margin-bottom: 50px; }
        .header h1 {
            font-size: 3.5em; font-weight: 900; letter-spacing: -2px;
            background: linear-gradient(to right, #fff, #a5b4fc);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* Glass Card Effect */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
        }

        .upload-area {
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 60px 20px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }
        .upload-area:hover { border-color: #667eea; background: rgba(255,255,255,0.03); }
        .upload-area.has-file { border-style: solid; border-color: #4facfe; padding: 10px; }

        .btn {
            padding: 16px 36px; font-size: 1em; border: none; border-radius: 50px;
            cursor: pointer; font-weight: 700; text-transform: uppercase;
            transition: var(--transition); color: white; display: inline-flex; align-items: center; gap: 10px;
        }
        .btn-primary { background: var(--primary-gradient); box-shadow: 0 10px 20px -5px rgba(102, 126, 234, 0.5); }
        .btn-success { background: var(--success-gradient); box-shadow: 0 10px 20px -5px rgba(79, 172, 254, 0.5); }
        .btn:hover { transform: translateY(-3px); filter: brightness(1.1); }
        .btn:disabled { opacity: 0.5; transform: none; cursor: not-allowed; }

        /* CC Controls Glass Styling */
        .control-group { margin-bottom: 25px; }
        .control-group label { display: block; margin-bottom: 12px; font-weight: 600; color: #cbd5e1; }
        input[type="range"] {
            width: 100%; height: 6px; border-radius: 10px; appearance: none;
            background: rgba(255,255,255,0.1); outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            appearance: none; width: 20px; height: 20px; border-radius: 50%;
            background: #fff; cursor: pointer; box-shadow: 0 0 15px rgba(102, 126, 234, 0.8);
        }

        .filter-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; margin-bottom: 30px;
        }
        .filter-item {
            background: rgba(255,255,255,0.05); border: 1px solid transparent;
            padding: 15px; border-radius: 18px; text-align: center; cursor: pointer; transition: var(--transition);
        }
        .filter-item:hover { transform: scale(1.05); background: rgba(255,255,255,0.1); }
        .filter-item.active { border-color: #667eea; background: rgba(102, 126, 234, 0.2); }
        .filter-preview { height: 60px; border-radius: 10px; margin-bottom: 10px; }

        /* Progress Bar */
        .progress-box { display: none; margin: 30px 0; }
        .bar-outer { width: 100%; height: 12px; background: rgba(0,0,0,0.3); border-radius: 10px; overflow: hidden; }
        .bar-inner { height: 100%; width: 0%; background: var(--success-gradient); transition: width 0.3s; }

        .preview-grid { display: none; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 40px; }
        .preview-box { background: rgba(0,0,0,0.2); border-radius: 18px; overflow: hidden; border: 1px solid var(--glass-border); }
        .preview-tag { padding: 10px; background: rgba(255,255,255,0.05); text-align: center; font-size: 0.8em; font-weight: 700; }
        .preview-img { width: 100%; height: 350px; object-fit: contain; }

        @media (max-width: 768px) {
            .header h1 { font-size: 2.2em; }
            .preview-grid { grid-template-columns: 1fr; }
            .glass-card { padding: 20px; }
            .btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>AI Photo Upscaler</h1>
        <p>Premium 4K Enhancement & CC Filters</p>
    </div>

    <div class="glass-card">
        <div id="alertBox" style="display:none; padding: 15px; border-radius: 12px; margin-bottom: 20px; background: rgba(79, 172, 254, 0.2); border: 1px solid #4facfe; color: #4facfe; font-weight: 600;"></div>

        <div class="upload-area" id="dropZone" onclick="document.getElementById('fileInput').click()">
            <div id="uploadUi">
                <div style="font-size: 4em; margin-bottom: 15px;">üñºÔ∏è</div>
                <h3>Drop Image or Click to Browse</h3>
                <p style="color: #94a3b8; font-size: 0.9em; margin-top: 10px;">Supports PNG, JPG, WebP (Max 50MB)</p>
            </div>
            <div id="mediaPreview" style="display: none; position: relative;">
                <img id="sourceImg" style="max-width: 100%; border-radius: 15px; height: 300px; object-fit: contain;">
                <button onclick="event.stopPropagation(); location.reload();" style="position: absolute; top: 10px; right: 10px; background: #ef4444; border: none; color: white; width: 40px; height: 40px; border-radius: 50%; cursor: pointer;">‚úï</button>
            </div>
            <input type="file" id="fileInput" hidden accept="image/*">
        </div>

        <div id="controls" style="display: none; margin-top: 40px;">
            <h3 style="margin-bottom: 20px;">üé® Professional Filters</h3>
            <div class="filter-grid" id="filterGrid"></div>

            <h3 style="margin-bottom: 20px;">‚öôÔ∏è Color Correction</h3>
            <div class="control-group">
                <label>Brightness</label>
                <input type="range" id="brightness" min="-100" max="100" value="0">
            </div>
            <div class="control-group">
                <label>Contrast</label>
                <input type="range" id="contrast" min="-100" max="100" value="0">
            </div>
            <div class="control-group">
                <label>Saturation</label>
                <input type="range" id="saturation" min="-100" max="100" value="0">
            </div>
            <div class="control-group">
                <label>Sharpness</label>
                <input type="range" id="sharpness" min="-100" max="100" value="0">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px;">
                <div class="control-group">
                    <label>Upscale Multiplier</label>
                    <select id="scaleSelect" style="width: 100%; padding: 12px; border-radius: 10px; background: rgba(255,255,255,0.05); color: white; border: 1px solid var(--glass-border);">
                        <option value="2">2x Upscale</option>
                        <option value="4" selected>4x Ultra HD</option>
                        <option value="8">8x Maximum</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Format</label>
                    <select id="formatSelect" style="width: 100%; padding: 12px; border-radius: 10px; background: rgba(255,255,255,0.05); color: white; border: 1px solid var(--glass-border);">
                        <option value="png">PNG (Lossless)</option>
                        <option value="jpeg">JPG (Fast)</option>
                    </select>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" id="startBtn">‚ö° Start 4K Processing</button>
            </div>
        </div>

        <div class="progress-box" id="progressBox">
            <p id="statusText" style="text-align: center; margin-bottom: 10px; font-weight: 600;">AI is calculating pixels...</p>
            <div class="bar-outer"><div class="bar-inner" id="barInner"></div></div>
        </div>

        <div class="preview-grid" id="previewGrid">
            <div class="preview-box">
                <div class="preview-tag">ORIGINAL</div>
                <img id="finalOrig" class="preview-img">
            </div>
            <div class="preview-box">
                <div class="preview-tag" style="background: var(--success-gradient); color: #000;">ENHANCED 4K</div>
                <img id="finalEnhanced" class="preview-img">
            </div>
            <div style="grid-column: 1 / -1; text-align: center; margin-top: 20px;">
                <button class="btn btn-success" id="dlBtn">‚¨áÔ∏è Save to Gallery</button>
            </div>
        </div>
    </div>
</div>

<script>
    let worker;
    let processedUrl = null;
    const filterPresets = [
        { name: 'Standard', color: 'transparent' },
        { name: 'Cinematic', color: 'linear-gradient(135deg, #1e3c72, #2a5298)' },
        { name: 'Warmth', color: 'linear-gradient(135deg, #ff9a9e, #fad0c4)' },
        { name: 'Vibrant', color: 'linear-gradient(135deg, #a1c4fd, #c2e9fb)' },
        { name: 'Mono', color: 'linear-gradient(135deg, #333, #000)' }
    ];

    // Initialize UI
    const grid = document.getElementById('filterGrid');
    filterPresets.forEach(f => {
        const item = document.createElement('div');
        item.className = 'filter-item' + (f.name === 'Standard' ? ' active' : '');
        item.innerHTML = `<div class="filter-preview" style="background:${f.color}; border: 1px solid rgba(255,255,255,0.1)"></div><span>${f.name}</span>`;
        item.onclick = () => {
            document.querySelectorAll('.filter-item').forEach(i => i.classList.remove('active'));
            item.classList.add('active');
            window.activeFilter = f.name;
        };
        grid.appendChild(item);
    });

    // Worker Script Blob (Fixes syntax errors from previous versions)
    const workerCode = `
    self.onmessage = function(e) {
        const { data, width, height, settings, filter } = e.data;
        const total = data.length;
        
        const b = settings.brightness * 2.55;
        const c = (259 * (settings.contrast + 255)) / (255 * (259 - settings.contrast));
        const s = 1 + (settings.saturation / 100);

        for (let i = 0; i < total; i += 4) {
            // Brightness & Contrast
            data[i] = c * (data[i] + b - 128) + 128;     // R
            data[i+1] = c * (data[i+1] + b - 128) + 128; // G
            data[i+2] = c * (data[i+2] + b - 128) + 128; // B

            // Saturation
            const gray = 0.299 * data[i] + 0.587 * data[i+1] + 0.114 * data[i+2];
            data[i] = gray + (data[i] - gray) * s;
            data[i+1] = gray + (data[i+1] - gray) * s;
            data[i+2] = gray + (data[i+2] - gray) * s;

            // Simple Filter Logic
            if (filter === 'Cinematic') { data[i+2] += 10; data[i] -= 5; }
            if (filter === 'Warmth') { data[i] += 15; data[i+2] -= 10; }
            if (filter === 'Mono') { const m = (data[i]+data[i+1]+data[i+2])/3; data[i]=data[i+1]=data[i+2]=m; }

            if (i % 500000 === 0) self.postMessage({type: 'progress', val: Math.floor((i/total)*100)});
        }
        self.postMessage({type: 'done', data}, [data.buffer]);
    };`;

    const blob = new Blob([workerCode], { type: 'application/javascript' });
    worker = new Worker(URL.createObjectURL(blob));

    // File Handling
    document.getElementById('fileInput').onchange = function(e) {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
            document.getElementById('sourceImg').src = event.target.result;
            document.getElementById('uploadUi').style.display = 'none';
            document.getElementById('mediaPreview').style.display = 'block';
            document.getElementById('controls').style.display = 'block';
            document.getElementById('dropZone').classList.add('has-file');
        };
        reader.readAsDataURL(file);
    };

    // Processing
    document.getElementById('startBtn').onclick = function() {
        const source = document.getElementById('sourceImg');
        const scale = parseInt(document.getElementById('scaleSelect').value);
        
        this.disabled = true;
        document.getElementById('progressBox').style.display = 'block';
        
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        
        // Use GPU to scale image
        let w = source.naturalWidth * scale;
        let h = source.naturalHeight * scale;
        
        // Mobile RAM protection (limit to 12MP)
        if (w * h > 12000000) {
            const ratio = Math.sqrt(12000000 / (w * h));
            w = Math.floor(w * ratio);
            h = Math.floor(h * ratio);
        }

        canvas.width = w; canvas.height = h;
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';
        ctx.drawImage(source, 0, 0, w, h);

        const imgData = ctx.getImageData(0, 0, w, h);
        window.activeW = w; window.activeH = h;

        worker.postMessage({
            data: imgData.data,
            width: w,
            height: h,
            settings: {
                brightness: parseInt(document.getElementById('brightness').value),
                contrast: parseInt(document.getElementById('contrast').value),
                saturation: parseInt(document.getElementById('saturation').value)
            },
            filter: window.activeFilter || 'Standard'
        }, [imgData.data.buffer]);
    };

    worker.onmessage = function(e) {
        if(e.data.type === 'progress') {
            document.getElementById('barInner').style.width = e.data.val + '%';
        } else if(e.data.type === 'done') {
            const canvas = document.createElement('canvas');
            canvas.width = window.activeW; canvas.height = window.activeH;
            const ctx = canvas.getContext('2d');
            ctx.putImageData(new ImageData(e.data.data, window.activeW, window.activeH), 0, 0);
            
            processedUrl = canvas.toDataURL('image/' + document.getElementById('formatSelect').value);
            
            document.getElementById('progressBox').style.display = 'none';
            document.getElementById('previewGrid').style.display = 'grid';
            document.getElementById('finalOrig').src = document.getElementById('sourceImg').src;
            document.getElementById('finalEnhanced').src = processedUrl;
            document.getElementById('startBtn').disabled = false;
            
            document.getElementById('alertBox').style.display = 'block';
            document.getElementById('alertBox').innerText = "‚ú® AI Processing Complete!";
        }
    };

    document.getElementById('dlBtn').onclick = () => {
        const link = document.createElement('a');
        link.download = 'upscaled-pro-' + Date.now() + '.png';
        link.href = processedUrl;
        link.click();
    };
</script>

</body>
</html>
